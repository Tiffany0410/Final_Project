---
title: "JSC370 2020: Midterm Project"
author: "Shi Tang"
date: "10/03/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
library(ggplot2)

library(data.table)
library(dtplyr)

library(sjPlot)
library(sjmisc)
library(sjlabelled)
```

## How does immunization coverage affect life expectancy for year 2015?
A person's life expectancy is a statistical measure of the average time is expected to live, based on several factors such as birth, age, and other demographic factors. Indeed, the United Nations estimates a global average life expectancy of 72.6 years for 2019 â€“ which is higher than in any country back in 1950. Therefore, I am interested in exploring the impact of immunization coverage on life expectancy for the year 2015.

The data-set was from Kaggle https://www.kaggle.com/kumarajarshi/life-expectancy-who, and the original data related to life expectancy, health factors for 193 countries have been collected from WHO data repository website and its corresponding economic data was collected from United Nation website.

## Methods
```{r import data, echo = FALSE, include = FALSE}
data <- read_csv("life_expectancy_data.csv")
dim(data)
str(data)
```

The data-set consists of 22 columns and 2938 rows. Since we are only interested in immunization coverage for the year 2015, we will only select the columns we need from the data-set. 

```{r select data, echo = FALSE, include = FALSE}
filter_data <- data %>%
  select(c("Country", "Year", "Life expectancy", "Hepatitis B", "Polio", "Diphtheria")) %>%
  filter(Year == 2015) %>%
  rename("Life_expectancy" = "Life expectancy", "Hepatitis_B" = "Hepatitis B")
dim(filter_data)
```

Now, the data-set only contains 6 columns and 183 rows, including columns "Country", "Year", "Life expectancy", "Hepatitis B", "Polio" and "Diphtheria".

```{r checking NAs, echo = FALSE, include = FALSE}
NA_columns <- sapply(filter_data, function(x) sum(is.na(x)))
names(NA_columns[NA_columns > 0])

for (i in names(NA_columns[NA_columns > 0])) {
  filter_data[, i][is.na(filter_data[, i])] <- as.numeric(lapply(filter_data[, i], mean, na.rm = TRUE))
}
```

The columns "Life expectancy", "Hepatitis B", "Polio", "Diphtheria" contain missing values. We will impute these missing values using the mean.

```{r, echo = FALSE}
summary(filter_data$Life_expectancy)
```

From the summary table of life expectancy, the minimum average lifespan is 51.0 years and the maximum average lifespan is 88.0 years with median average lifespan of 73.90 years. 

Below are 3 boxplots for Hepatitis B (HepB), Polio (Pol3) and Diphtheria tetanus toxoid and pertussis (DTP3) immunization coverage among 1-year-old in percentage.

```{r fig.width = 5, fig.height = 4, echo=FALSE}
ggplot(filter_data, aes(x = Hepatitis_B)) +
  geom_boxplot() +
  theme_minimal() +
  labs(title = "Boxplot for HepB immnuization coverage")

ggplot(filter_data, aes(x = Polio)) +
  geom_boxplot() +
  theme_minimal() +
  labs(title = "Boxplot for Pol3 immnuization coverage")

ggplot(filter_data, aes(x = Diphtheria)) +
  geom_boxplot() +
  theme_minimal() +
  labs(title = "Boxplot for DTP3 immnuization coverage")
```

The median among all countries for all three immunizations has over 90% coverage, with a mean of around 83% coverage. 

Recall that our primary question of interest is the impact of immunization coverage on life expectancy. Now, we will start to explore the relationship between immunization coverage and life expectancy by creating visualization plots.

## Preliminary Results
First, we will create 3 scatterplots with regression lines showing the relationship between immunization coverage and life expectancy.

```{r fig.width = 5, fig.height = 4, echo=FALSE}
ggplot(filter_data, aes(x = Hepatitis_B, y = Life_expectancy)) +
  geom_point(size = 1, shape = 23) +
  geom_smooth(method = "lm", formula = y~x, se = TRUE, col = "pink") +
  theme_minimal() + 
  labs(title = "Hepatitis_B vs Life expectancy", x = "Hepatitis B", y = "Life Expectancy")
```

```{r fig.width = 5, fig.height = 4, echo=FALSE}
ggplot(filter_data, aes(x = Polio, y = Life_expectancy)) +
  geom_point(size = 1, shape = 23) +
  geom_smooth(method = "lm", formula = y~x, se = TRUE, col = "pink") +
  theme_minimal() + 
  labs(title = "Polio vs Life expectancy", x = "Polio", y = "Life Expectancy")
```

```{r fig.width = 5, fig.height = 4, echo=FALSE}
ggplot(filter_data, aes(x = Diphtheria, y = Life_expectancy)) +
  geom_point(size = 1, shape = 23) +
  geom_smooth(method = "lm", formula = y~x, se = TRUE, col = "pink") +
  theme_minimal() + 
  labs(title = "Diphtheria vs Life expectancy", x = "Diphtheria", y = "Life Expectancy")
```

Looking at the scatterplots, all suggest that there's a positive correlation between immunization coverage and life expectancy. We will further explore the correlation by creating a linear regression model to examine the association between life expectancy and Diphtheria, Polio and Hepatitis_B immunization coverage.

```{r echo=FALSE, include=FALSE}
lm_mod <- lm(Life_expectancy ~ Diphtheria + Polio + Hepatitis_B, data = filter_data)
```

Here's the table summary. 
```{r echo=FALSE}
tab_model(lm_mod)
```

Looking at the summary table, the p-values for predictors diphtheria and polio are very small, which suggests that it's unlikely that the relationship between weight and diphtheria and polio immunization coverage was due to chance.

## Conclusion
In conclusion, the scatterplots suggest that there are positive correlations between life expectancy and diphtheria, polio and hepatitis immunization coverage. The linear regression model, suggests that the positive relationship between weight and diphtheria and polio immunization coverage was unlikely due to chance.